<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Procesando tu compra...</title>
</head>
<body>
    <h3>Gracias por tu compra. Preparando tu descarga...</h3>

    <script>
        async function descargarYRedirigir() {
            try {
                const res = await fetch("/descargar_compra/{{ compra_id }}");

                if (res.ok) {
                    const blob = await res.blob();
                    const url = URL.createObjectURL(blob);

                    const a = document.createElement("a");
                    a.href = url;
                    a.download = "partituras.zip";
                    a.click();

                    URL.revokeObjectURL(url);
                }
            } catch (e) {
                console.error(e);
            }

            // Redirigir al index despuÃ©s de la descarga
            setTimeout(() => {
                window.location.href = "/";
            }, 2000);
        }

        descargarYRedirigir();
    </script>
</body>
</html>
